# 要件定義 - 朝連リマインダー

## 📝 アプリの目的

子育て家庭において、子どもの保育園や小学校で必要な持ち物やイベントを毎朝確実に確認・準備できるよう支援する。  
忙しい朝でも迷わず行動できることで、忘れ物・連絡漏れを減らすことを目指す。

### 🤔 解決したい課題
- 朝の忙しさで持ち物を忘れる
- 学校からの連絡を聞き逃す
- 複数の子どもの持ち物管理が混乱する
- イベントの準備が直前になって慌てる

### 💪 期待される効果
- 忘れ物の減少
- 朝の準備時間の短縮
- 子どもの安心感向上
- 保護者のストレス軽減


## 👥 想定ユーザー

### プライマリユーザー
- 小学校・保育園に通う子どもの保護者
- 年齢：30-45歳
- 忙しく朝の準備が慌ただしい家庭
- スマートフォンを日常的に使用

### セカンダリユーザー
- 複数の子どもがいる家庭（今後対応予定）
- 祖父母など、子どもの世話を手伝う家族
- 共働き家庭

### ユーザーの行動パターン
- 朝7-8時頃にアプリを確認
- 前日の夜に翌日の準備を確認
- 週末に翌週の準備を整理
- 学校からの連絡を整理


## 🧪 ユースケース

### 基本フロー

| シナリオ | 説明 | 頻度 |
|----------|------|------|
| 初期設定 | 子どもの名前・学年・カラー・持ち物ルールを登録する | 初回のみ |
| 通知受信 | 朝に「今日の持ち物」が通知される | 毎日 |
| 持ち物確認 | アプリを開いて持ち物リストを確認する | 毎日 |
| 設定変更 | 曜日ごとに持ち物やイベントを編集する | 必要時 |

### 詳細ユースケース

#### 1. 子ども登録フロー
1. アプリ初回起動時に子ども情報を入力
2. 名前、学年、好きな色を設定
3. 基本の持ち物パターンを登録（曜日別）

#### 2. 日常使用フロー
1. 朝に通知が届く
2. 通知をタップしてアプリを開く
3. 当日の持ち物リストを確認
4. 必要に応じてチェックリストとして使用

#### 3. 設定変更フロー
1. 学校からの連絡で持ち物が変更
2. アプリで該当曜日の設定を編集
3. 変更内容を保存

---

## 📦 対応プラットフォーム

### 初期リリース
- **Android**: 最低対象 Android 8.0（API 26）以上
- **iOS**: 最低対象 iOS 14.0 以上
- **デバイス**: スマートフォンのみ（タブレットは非対応）

### 技術制約
- 端末内に完結するローカルアプリ
- インターネット接続不要
- データは端末内SQLiteに保存


## ✅ 機能要件（初期バージョン）

### 📋 データ管理

#### 子ども情報管理
- [x] 子どもの基本情報（名前、学年、カラー、画像）
- [x] SQLiteデータベースでの永続化
- [x] 子どもの削除・編集機能

#### 持ち物管理
- [x] 持ち物の登録・編集・削除（曜日別に設定）
- [x] 持ち物カテゴリ（教科書、給食、体育着など）
- [x] 持ち物の重要度設定（必須/任意）
- [x] 持ち物のメモ機能
- [x] SQLiteデータベースでの永続化

#### イベント管理
- [x] イベントの登録（遠足、プール、参観日など）
- [x] イベント日時の設定
- [x] イベント専用の持ち物リスト
- [x] イベントの繰り返し設定（年次など）
- [x] SQLiteデータベースでの永続化

### 🖥 画面構成

#### メイン画面
- [ ] ホーム画面（当日の持ち物表示）
- [ ] 子ども一覧画面
- [ ] 子ども詳細・編集画面

#### 設定・管理画面
- [ ] 持ち物編集画面
- [ ] イベント管理画面
- [ ] 通知設定画面（時間・ON/OFF）
- [ ] アプリ設定画面

#### UI/UX要件
- [ ] 直感的で分かりやすいインターフェース
- [ ] 大きなボタンとタッチしやすい設計
- [ ] ダークモード対応
- [ ] アクセシビリティ対応

#### イベント管理（拡張）
- [ ] カレンダー画面でのイベント表示
- [ ] 月間・週間・日間ビューの切り替え
- [ ] イベントのカラーコーディング（子ども別）
- [ ] Googleカレンダーとの同期機能（将来的）

### ⏰ 通知機能

#### 基本通知
- [ ] 毎朝決まった時間に通知（デフォルト：7:00）
- [ ] 通知内容は当日必要な持ち物一覧
- [ ] 通知のON/OFF切り替え
- [ ] 通知時間の変更

#### 高度な通知
- [ ] イベント前日の通知
- [ ] 持ち物変更時の即座通知
- [ ] 通知音・バイブレーション設定

---

## ❌ 非対応（初期バージョンでは除外）

### 機能面
- 複数端末でのデータ同期
- アカウント認証（Googleログインなど）
- 他の保護者との共有機能
- カレンダーアプリとの連携
- 写真・画像の添付機能

### 技術面
- クラウドストレージ連携
- プッシュ通知（サーバーサイド）
- データエクスポート/インポート
- バックアップ機能

#### 非対応（更新）
- カレンダーアプリとの連携 → 将来的に対応予定

---

## 💡 非機能要件

### パフォーマンス
- アプリ起動時間：3秒以内
- 画面遷移：1秒以内
- データ保存：即座に反映

### 可用性
- オフライン環境でも使用可能（ネット不要）
- アプリ内のすべてのデータは SQLite に保存
- 通知は `flutter_local_notifications` によるローカル通知

### セキュリティ
- 認証・ログイン機能はなし
- 個人情報は端末内のみ保存
- 外部へのデータ送信なし

### 保守性
- モジュール化された設計
- テストコードの作成
- エラーハンドリングの実装

---

## 🎨 UI/UX設計指針

### デザイン原則
- Material Design 3に準拠
- シンプルで直感的な操作
- 朝の忙しい時間でも使いやすい
- 子どもが喜ぶ可愛らしいデザイン
- 視認性の高い配色

### 詳細仕様
詳細なデザインガイドラインは `docs/design_guidelines.md` を参照してください。

### カラーパレット
- メインカラー：優しいブルー系
- アクセントカラー：明るいオレンジ系
- 背景色：白またはライトグレー
- テキスト：ダークグレー

### アイコン・イラスト
- Material Icons使用
- 親しみやすいキャラクター
- 分かりやすいアイコン

---

## 🎯 成功指標

### 定量的指標
- アプリの日次アクティブユーザー率：60%以上
- 通知開封率：80%以上
- アプリ評価：4.0以上
- クラッシュ率：1%以下

### 定性的指標
- ユーザーからの「忘れ物が減った」という声
- 朝の準備時間の短縮感
- アプリの使いやすさへの満足度

---

## 🚀 将来的に検討したい機能（メモ）

### 短期（3-6ヶ月後）
- クラウド同期（FirebaseやSupabaseなど）
- データエクスポート/インポート機能
- より詳細な通知設定

### 中期（6-12ヶ月後）
- 他の保護者と共有（LINE連携や共有URL）
- カレンダーアプリとの連携
- 写真・画像の添付機能

### 長期（1年以上）
- シーズンごとのアイテム提案（例：冬→手袋）
- 祝日・学校行事に基づく通知の最適化
- AIによる持ち物提案機能
- 複数端末でのリアルタイム同期

---

## 📝 開発スケジュール

### Phase 1（1-2週間）
- プロジェクトセットアップ
- 基本UI/UX設計
- データベース設計

### Phase 2（2-3週間）
- 子ども情報管理機能
- 持ち物管理機能
- 基本画面の実装

### Phase 3（1-2週間）
- 通知機能の実装
- イベント管理機能
- 設定画面の実装

### Phase 4（1週間）
- テスト・デバッグ
- UI/UXの調整
- リリース準備

---

## 🚀 CI/CD設定

### GitHub Actions ワークフロー

#### テスト自動実行
- **ファイル**: `.github/workflows/test.yml`
- **トリガー**: PR作成・更新、main/developブランチへのプッシュ
- **実行内容**:
  - Flutter環境セットアップ
  - 依存関係インストール
  - コード分析 (flutter analyze)
  - フォーマットチェック (dart format)
  - 単体テスト実行 (flutter test)
  - カバレッジ測定
  - テスト結果をPRにコメント投稿

#### PR自動サマリー
- **ファイル**: `.github/workflows/pr-summary.yml`
- **トリガー**: PR作成時
- **実行内容**:
  - 変更ファイルの分析
  - 影響範囲の予測
  - PR概要の自動生成・投稿

### テスト実行コマンド

#### ローカル実行
```bash
# 全テスト実行
flutter test

# 特定ディレクトリのテスト
flutter test test/models/

# カバレッジ付きテスト
flutter test --coverage
```

#### CI/CD実行
- GitHub Actionsで自動実行
- PR作成時にテスト結果をコメント投稿
- カバレッジレポートをArtifactsに保存

---

この要件定義はアプリの成長に応じて更新されます。

## 🎯 実装履歴

### 2025年6月 - モデルクラス実装
- [x] `Child`モデルクラスの作成（`lib/models/child.dart`）
  - 子どもの名前、学年、カラー、ID、作成・更新日時を管理
  - `fromMap`/`toMap`メソッドでSQLite対応
  - `create`ファクトリメソッドで新規作成
  - `copyWith`メソッドで更新操作
  - null safety対応

- [x] `Item`モデルクラスの作成（`lib/models/item.dart`）
  - 持ち物の名前、カテゴリ、曜日、重要度、メモ、子どもIDを管理
  - 曜日は数値（1-7）で管理し、`dayOfWeekText`で文字列取得
  - 重要度は数値（1: 必須, 2: 任意）で管理し、`importanceText`で文字列取得
  - `isRequired`プロパティで必須判定
  - `fromMap`/`toMap`メソッドでSQLite対応
  - `create`ファクトリメソッドで新規作成
  - `copyWith`メソッドで更新操作
  - null safety対応

- [x] 単体テストの作成
  - `test/models/child_test.dart` - Childモデルの全機能をテスト
  - `test/models/item_test.dart` - Itemモデルの全機能をテスト
  - fromMap/toMap、create、copyWith、比較演算子、getterメソッドをカバー

### 2025年6月27日 - Childモデル拡張
- [x] `Child`モデルに顔画像機能を追加
  - `photoPath`フィールドを追加（String?型でnull safety対応）
  - `hasPhoto`プロパティで画像の有無を判定
  - `fromMap`/`toMap`メソッドに画像パス対応を追加
  - `create`/`copyWith`メソッドに画像パス対応を追加
  - 単体テストを更新して画像機能をカバー

### 2025年6月27日 - SQLiteデータベース実装
- [x] 依存関係の追加
  - `sqflite: ^2.3.3+1` - SQLite操作用
  - `path_provider: ^2.1.4` - アプリ内保存場所の取得用
  - `path: ^1.9.0` - パス操作用

- [x] `Event`モデルクラスの作成（`lib/models/event.dart`）
  - イベントのタイトル、説明、開始・終了日時、場所、種類、繰り返し設定を管理
  - 終日イベント対応（`endDate`がnullの場合）
  - 繰り返し設定（なし、毎年、毎月、毎週）
  - `isOnDate`メソッドで指定日付のイベント判定
  - `fromMap`/`toMap`メソッドでSQLite対応
  - `create`ファクトリメソッドで新規作成
  - `copyWith`メソッドで更新操作
  - null safety対応

- [x] `AppDatabase`クラスの作成（`lib/db/app_database.dart`）
  - シングルトンパターンでデータベースインスタンス管理
  - 3つのテーブル（children、items、events）の作成
  - 外部キー制約による参照整合性の保証
  - インデックスによる検索パフォーマンスの最適化
  - CRUD操作の完全実装（Create、Read、Update、Delete）
  - 日付範囲検索、曜日別検索、子ども別検索の実装
  - データベース統計情報の取得機能
  - エラーハンドリングとトランザクション管理

- [x] 単体テストの作成
  - `test/models/event_test.dart` - Eventモデルの全機能をテスト
  - `test/db/app_database_test.dart` - データベース操作の全機能をテスト
  - 各モデルのCRUD操作、検索機能、統計機能をカバー
  - 外部キー制約とデータ整合性のテスト

### 技術仕様
- **データベース名**: `asaren_reminder.db`
- **バージョン**: 1
- **テーブル構成**:
  - `children`: 子どもの基本情報
  - `items`: 持ち物情報（childrenテーブルと外部キー制約）
  - `events`: イベント情報（childrenテーブルと外部キー制約）
- **インデックス**: 検索パフォーマンス向上のため適切なインデックスを設定
- **null safety**: 全モデルでnull safety対応
- **エラーハンドリング**: try-catch文による適切なエラー処理